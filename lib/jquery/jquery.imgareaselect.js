(function(b){function z(){return b("<div/>")}var A=Math.abs,m=Math.max,n=Math.min,o=Math.round;b.imgAreaSelect=function(j,c){function N(a){return a+C.left-v.left}function O(a){return a+C.top-v.top}function H(a){return a-C.left+v.left}function I(a){return a-C.top+v.top}function D(a){var i=a||da;a=a||ea;return{x1:o(d.x1*i),y1:o(d.y1*a),x2:o(d.x2*i),y2:o(d.y2*a),width:o(d.x2*i)-o(d.x1*i),height:o(d.y2*a)-o(d.y1*a)}}function fa(a,i,y,X,S){var qa=S||da;S=S||ea;d={x1:o(a/qa||0),y1:o(i/S||0),x2:o(y/qa||
0),y2:o(X/S||0)};d.width=d.x2-d.x1;d.height=d.y2-d.y1}function J(){if(w.width()){C={left:o(w.offset().left),top:o(w.offset().top)};x=w.innerWidth();t=w.innerHeight();C.top+=w.outerHeight()-t>>1;C.left+=w.outerWidth()-x>>1;T=c.minWidth||0;U=c.minHeight||0;ga=n(c.maxWidth||16777216,x);ha=n(c.maxHeight||16777216,t);if(b().jquery=="1.3.2"&&Y=="fixed"&&!ia.getBoundingClientRect){C.top+=m(document.body.scrollTop,ia.scrollTop);C.left+=m(document.body.scrollLeft,ia.scrollLeft)}v=b.inArray(P.css("position"),
["absolute","relative"])+1?{left:o(P.offset().left)-P.scrollLeft(),top:o(P.offset().top)-P.scrollTop()}:Y=="fixed"?{left:b(document).scrollLeft(),top:b(document).scrollTop()}:{left:0,top:0};p=N(0);q=O(0);if(d.x2>x||d.y2>t)Z()}}function $(a){if(aa){k.css({left:N(d.x1),top:O(d.y1)}).add(Q).width(E=d.width).height(K=d.height);Q.add(s).add(r).css({left:0,top:0});s.width(m(E-s.outerWidth()+s.innerWidth(),0)).height(m(K-s.outerHeight()+s.innerHeight(),0));b(l[0]).css({left:p,top:q,width:d.x1,height:t});
b(l[1]).css({left:p+d.x1,top:q,width:E,height:d.y1});b(l[2]).css({left:p+d.x2,top:q,width:x-d.x2,height:t});b(l[3]).css({left:p+d.x1,top:q+d.y2,width:E,height:t-d.y2});E-=r.outerWidth();K-=r.outerHeight();switch(r.length){case 8:b(r[4]).css({left:E>>1});b(r[5]).css({left:E,top:K>>1});b(r[6]).css({left:E>>1,top:K});b(r[7]).css({top:K>>1});case 4:r.slice(1,3).css({left:E});r.slice(2,4).css({top:K})}if(a!==false){b.imgAreaSelect.keyPress!=ra&&b(document).unbind(b.imgAreaSelect.keyPress,b.imgAreaSelect.onKeyPress);
if(c.keys)b(document)[b.imgAreaSelect.keyPress](b.imgAreaSelect.onKeyPress=ra)}if(b.browser.msie&&s.outerWidth()-s.innerWidth()==2){s.css("margin",0);setTimeout(function(){s.css("margin","auto")},0)}}}function ja(a){J();$(a);e=N(d.x1);f=O(d.y1);g=N(d.x2);h=O(d.y2)}function ka(a,i){c.fadeSpeed?a.fadeOut(c.fadeSpeed,i):a.hide()}function L(a){var i=H(a.pageX-v.left)-d.x1;a=I(a.pageY-v.top)-d.y1;if(!la){J();la=true;k.one("mouseout",function(){la=false})}u="";if(c.resizable){if(a<=c.resizeMargin)u="n";
else if(a>=d.height-c.resizeMargin)u="s";if(i<=c.resizeMargin)u+="w";else if(i>=d.width-c.resizeMargin)u+="e"}k.css("cursor",u?u+"-resize":c.movable?"move":"");ba&&ba.toggle()}function sa(){b("body").css("cursor","");if(c.autoHide||d.width*d.height==0)ka(k.add(l),function(){b(this).hide()});b(document).unbind("mousemove",ma);k.mousemove(L);c.onSelectEnd(j,D())}function ta(a){if(a.which!=1)return false;J();if(u){b("body").css("cursor",u+"-resize");e=N(d[/w/.test(u)?"x2":"x1"]);f=O(d[/n/.test(u)?"y2":
"y1"]);b(document).mousemove(ma).one("mouseup",sa);k.unbind("mousemove",L)}else if(c.movable){na=p+d.x1-(a.pageX-v.left);oa=q+d.y1-(a.pageY-v.top);k.unbind("mousemove",L);b(document).mousemove(ua).one("mouseup",function(){c.onSelectEnd(j,D());b(document).unbind("mousemove",ua);k.mousemove(L)})}else w.mousedown(a);return false}function V(a){if(F)if(a){g=m(p,n(p+x,e+A(h-f)*F*(g>e||-1)));h=o(m(q,n(q+t,f+A(g-e)/F*(h>f||-1))));g=o(g)}else{h=m(q,n(q+t,f+A(g-e)/F*(h>f||-1)));g=o(m(p,n(p+x,e+A(h-f)*F*(g>
e||-1))));h=o(h)}}function Z(){e=n(e,p+x);f=n(f,q+t);if(A(g-e)<T){g=e-T*(g<e||-1);if(g<p)e=p+T;else if(g>p+x)e=p+x-T}if(A(h-f)<U){h=f-U*(h<f||-1);if(h<q)f=q+U;else if(h>q+t)f=q+t-U}g=m(p,n(g,p+x));h=m(q,n(h,q+t));V(A(g-e)<A(h-f)*F);if(A(g-e)>ga){g=e-ga*(g<e||-1);V()}if(A(h-f)>ha){h=f-ha*(h<f||-1);V(true)}d={x1:H(n(e,g)),x2:H(m(e,g)),y1:I(n(f,h)),y2:I(m(f,h)),width:A(g-e),height:A(h-f)};$();c.onSelectChange(j,D())}function ma(a){g=u==""||/w|e/.test(u)||F?a.pageX-v.left:N(d.x2);h=u==""||/n|s/.test(u)||
F?a.pageY-v.top:O(d.y2);Z();return false}function W(a,i){g=(e=a)+d.width;h=(f=i)+d.height;b.extend(d,{x1:H(e),y1:I(f),x2:H(g),y2:I(h)});$();c.onSelectChange(j,D())}function ua(a){e=m(p,n(na+(a.pageX-v.left),p+x-d.width));f=m(q,n(oa+(a.pageY-v.top),q+t-d.height));W(e,f);a.preventDefault();return false}function va(){J();g=e;h=f;Z();u="";if(l.is(":not(:visible)"))k.add(l).hide().fadeIn(c.fadeSpeed||0);aa=true;b(document).unbind("mouseup",wa).mousemove(ma).one("mouseup",sa);k.unbind("mousemove",L);c.onSelectStart(j,
D())}function wa(){b(document).unbind("mousemove",va);ka(k.add(l));fa(H(e),I(f),H(e),I(f));c.onSelectChange(j,D());c.onSelectEnd(j,D())}function pa(a){if(a.which!=1||l.is(":animated"))return false;J();na=e=a.pageX-v.left;oa=f=a.pageY-v.top;b(document).one("mousemove",va).one("mouseup",wa);return false}function xa(){ja(false)}function ya(){za=true;Aa(c=b.extend({classPrefix:"imgareaselect",movable:true,parent:"body",resizable:true,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},
onSelectEnd:function(){}},c));k.add(l).css({visibility:""});if(c.show){aa=true;J();$();k.add(l).hide().fadeIn(c.fadeSpeed||0)}setTimeout(function(){c.onInit(j,D())},0)}function ca(a,i){for(option in i)c[option]!==undefined&&a.css(i[option],c[option])}function Aa(a){if(a.parent)(P=b(a.parent)).append(k.add(l));b.extend(c,a);J();if(a.handles!=null){r.remove();r=b([]);for(R=a.handles?a.handles=="corners"?4:8:0;R--;)r=r.add(z());r.addClass(c.classPrefix+"-handle").css({position:"absolute",fontSize:0,
zIndex:G+1||1});!parseInt(r.css("width"))>=0&&r.width(5).height(5);if(B=c.borderWidth)r.css({borderWidth:B,borderStyle:"solid"});ca(r,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}da=c.imageWidth/x||1;ea=c.imageHeight/t||1;if(a.x1!=null){fa(a.x1,a.y1,a.x2,a.y2);a.show=!a.hide}if(a.keys)c.keys=b.extend({shift:1,ctrl:"resize"},a.keys);l.addClass(c.classPrefix+"-outer");Q.addClass(c.classPrefix+"-selection");for(R=0;R++<4;)b(s[R-1]).addClass(c.classPrefix+"-border"+
R);ca(Q,{selectionColor:"background-color",selectionOpacity:"opacity"});ca(s,{borderOpacity:"opacity",borderWidth:"border-width"});ca(l,{outerColor:"background-color",outerOpacity:"opacity"});if(B=c.borderColor1)b(s[0]).css({borderStyle:"solid",borderColor:B});if(B=c.borderColor2)b(s[1]).css({borderStyle:"dashed",borderColor:B});k.append(Q.add(s).add(ba).add(r));if(b.browser.msie){if(B=l.css("filter").match(/opacity=([0-9]+)/))l.css("opacity",B[1]/100);if(B=s.css("filter").match(/opacity=([0-9]+)/))s.css("opacity",
B[1]/100)}if(a.hide)ka(k.add(l));else if(a.show&&za){aa=true;k.add(l).fadeIn(c.fadeSpeed||0);ja()}F=(Ba=(c.aspectRatio||"").split(/:/))[0]/Ba[1];w.add(l).unbind("mousedown",pa);if(c.disable||c.enable===false){k.unbind("mousemove",L).unbind("mousedown",ta);b(window).unbind("resize",xa)}else{if(c.enable||c.disable===false){if(c.resizable||c.movable)k.mousemove(L).mousedown(ta);b(window).resize(xa)}c.persistent||w.add(l).mousedown(pa)}c.enable=c.disable=undefined}var w=b(j),za,k=z(),Q=z(),s=z().add(z()).add(z()).add(z()),
l=z().add(z()).add(z()).add(z()),r=b([]),ba,p,q,C,x,t,P,v,G=0,Y="absolute",na,oa,da,ea,u,T,U,ga,ha,F,aa,e,f,g,h,d={x1:0,y1:0,x2:0,y2:0,width:0,height:0},ia=document.documentElement,M,Ba,R,B,E,K,la,ra=function(a){var i=c.keys,y,X=a.keyCode;y=!isNaN(i.alt)&&(a.altKey||a.originalEvent.altKey)?i.alt:!isNaN(i.ctrl)&&a.ctrlKey?i.ctrl:!isNaN(i.shift)&&a.shiftKey?i.shift:!isNaN(i.arrows)?i.arrows:10;if(i.arrows=="resize"||i.shift=="resize"&&a.shiftKey||i.ctrl=="resize"&&a.ctrlKey||i.alt=="resize"&&(a.altKey||
a.originalEvent.altKey)){switch(X){case 37:y=-y;case 39:a=m(e,g);e=n(e,g);g=m(a+y,e);V();break;case 38:y=-y;case 40:a=m(f,h);f=n(f,h);h=m(a+y,f);V(true);break;default:return}Z()}else{e=n(e,g);f=n(f,h);switch(X){case 37:W(m(e-y,p),f);break;case 38:W(e,m(f-y,q));break;case 39:W(e+n(y,x-H(g)),f);break;case 40:W(e,f+n(y,t-I(h)));break;default:return}}return false};this.remove=function(){w.unbind("mousedown",pa);k.add(l).remove()};this.getOptions=function(){return c};this.setOptions=Aa;this.getSelection=
D;this.setSelection=fa;this.update=ja;for(M=w;M.length;){G=m(G,!isNaN(M.css("z-index"))?M.css("z-index"):G);if(M.css("position")=="fixed")Y="fixed";M=M.parent(":not(body)")}G=c.zIndex||G;b.browser.msie&&w.attr("unselectable","on");b.imgAreaSelect.keyPress=b.browser.msie||b.browser.safari?"keydown":"keypress";if(b.browser.opera)ba=z().css({width:"100%",height:"100%",position:"absolute",zIndex:G+2||2});k.add(l).css({visibility:"hidden",position:Y,overflow:"hidden",zIndex:G||"0"});k.css({zIndex:G+2||
2});Q.add(s).css({position:"absolute",fontSize:0});j.complete||j.readyState=="complete"||!w.is("img")?ya():w.one("load",ya)};b.fn.imgAreaSelect=function(j){j=j||{};this.each(function(){if(b(this).data("imgAreaSelect"))if(j.remove){b(this).data("imgAreaSelect").remove();b(this).removeData("imgAreaSelect")}else b(this).data("imgAreaSelect").setOptions(j);else if(!j.remove){if(j.enable===undefined&&j.disable===undefined)j.enable=true;b(this).data("imgAreaSelect",new b.imgAreaSelect(this,j))}});if(j.instance)return b(this).data("imgAreaSelect");
return this}})(jQuery);
