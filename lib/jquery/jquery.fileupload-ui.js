(function(h){var o,m,r=function(f,k){var b,i;if(!k.test(f.type))return null;b=document.createElement("img");if(typeof URL!=="undefined"&&typeof URL.createObjectURL==="function"){b.src=URL.createObjectURL(f);b.onload=function(){URL.revokeObjectURL(this.src)};return b}if(typeof FileReader!=="undefined"){i=new FileReader;if(typeof i.readAsDataURL==="function"){i.onload=function(l){b.src=l.target.result};i.readAsDataURL(f);return b}}return null};o=function(f,k){var b=this,i,l;this.requestHeaders={Accept:"application/json, text/javascript, */*; q=0.01"};
this.dropZone=f;this.imageTypes=/^image\/(gif|jpeg|png)$/;this.previewSelector=".file_upload_preview";this.progressSelector=".file_upload_progress div";this.cancelSelector=".file_upload_cancel button";this.cssClassSmall="file_upload_small";this.cssClassLarge="file_upload_large";this.cssClassHighlight="file_upload_highlight";this.dropEffect="highlight";this.uploadTable=this.downloadTable=null;this.buildUploadRow=this.buildDownloadRow=function(){return null};this.addNode=function(c,d,e){if(d)d.css("display",
"none").appendTo(c).fadeIn(function(){if(typeof e==="function")try{e()}catch(g){h(this).stop();throw g;}});else typeof e==="function"&&e()};this.removeNode=function(c,d){if(c)c.fadeOut(function(){h(this).remove();if(typeof d==="function")try{d()}catch(e){h(this).stop();throw e;}});else typeof d==="function"&&d()};this.onAbort=function(c,d,e,g,a){a.removeNode(a.uploadRow)};this.cancelUpload=function(c,d,e,g,a){var j=g.readyState;g.abort();if(isNaN(j)||j<2)a.onAbort(c,d,e,g,a)};this.initProgressBar=
function(c,d){if(typeof c.progressbar==="function")return c.progressbar({value:d});else{var e=h('<progress value="'+d+'" max="100"/>').appendTo(c);e.progressbar=function(g,a){e.attr("value",a)};return e}};this.initUploadRow=function(c,d,e,g,a,j){if(c=a.uploadRow=a.buildUploadRow(d,e,a)){a.progressbar=a.initProgressBar(c.find(a.progressSelector),g.upload?0:100);c.find(a.cancelSelector).click(function(n){a.cancelUpload(n,d,e,g,a)});c.find(a.previewSelector).each(function(){h(this).append(new r(d[e],
a.imageTypes))})}a.addNode(typeof a.uploadTable==="function"?a.uploadTable(a):a.uploadTable,c,j)};this.initUpload=function(c,d,e,g,a,j){a.initUploadRow(c,d,e,g,a,function(){typeof a.beforeSend==="function"?a.beforeSend(c,d,e,g,a,j):j()})};this.onProgress=function(c,d,e,g,a){a.progressbar&&a.progressbar.progressbar("value",parseInt(c.loaded/c.total*100,10))};this.parseResponse=function(c){return typeof c.responseText!=="undefined"?h.parseJSON(c.responseText):h.parseJSON(c.contents().text())};this.initDownloadRow=
function(c,d,e,g,a,j){var n,p;try{n=a.response=a.parseResponse(g);p=a.downloadRow=a.buildDownloadRow(n,a);a.addNode(typeof a.downloadTable==="function"?a.downloadTable(a):a.downloadTable,p,j)}catch(q){if(typeof a.onError==="function"){a.originalEvent=c;a.onError(q,d,e,g,a)}else throw q;}};this.onLoad=function(c,d,e,g,a){a.removeNode(a.uploadRow,function(){a.initDownloadRow(c,d,e,g,a,function(){typeof a.onComplete==="function"&&a.onComplete(c,d,e,g,a)})})};this.dropZoneEnlarge=function(){if(!l){if(typeof b.dropZone.switchClass===
"function")b.dropZone.switchClass(b.cssClassSmall,b.cssClassLarge);else{b.dropZone.addClass(b.cssClassLarge);b.dropZone.removeClass(b.cssClassSmall)}l=true}};this.dropZoneReduce=function(){if(typeof b.dropZone.switchClass==="function")b.dropZone.switchClass(b.cssClassLarge,b.cssClassSmall);else{b.dropZone.addClass(b.cssClassSmall);b.dropZone.removeClass(b.cssClassLarge)}l=false};this.onDocumentDragEnter=function(){b.dropZoneEnlarge()};this.onDocumentDragOver=function(){i&&clearTimeout(i);i=setTimeout(function(){b.dropZoneReduce()},
200)};this.onDragEnter=this.onDragLeave=function(){b.dropZone.toggleClass(b.cssClassHighlight)};this.onDrop=function(){i&&clearTimeout(i);if(b.dropEffect&&typeof b.dropZone.effect==="function")b.dropZone.effect(b.dropEffect,function(){b.dropZone.removeClass(b.cssClassHighlight);b.dropZoneReduce()});else{b.dropZone.removeClass(b.cssClassHighlight);b.dropZoneReduce()}};h.extend(this,k)};m={init:function(f){return this.each(function(){h(this).fileUpload(new o(h(this),f))})},option:function(f,k,b){if(typeof f===
"undefined"||typeof f==="string"&&typeof k==="undefined")return h(this).fileUpload("option",f,k,b);return this.each(function(){h(this).fileUpload("option",f,k,b)})},destroy:function(f){return this.each(function(){h(this).fileUpload("destroy",f)})}};h.fn.fileUploadUI=function(f){if(m[f])return m[f].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof f==="object"||!f)return m.init.apply(this,arguments);else h.error("Method "+f+" does not exist on jQuery.fileUploadUI")}})(jQuery);
