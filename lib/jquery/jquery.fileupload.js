(function(g){var v,q,G=function(h,k){var l=0;this.complete=function(){l+=1;l===k&&h()}};v=function(h){var k=this,l,m,e={namespace:"file_upload",uploadFormFilter:function(){return true},fileInputFilter:function(){return true},cssClass:"file_upload",dragDropSupport:true,dropZone:h,url:function(a){return a.attr("action")},method:function(a){return a.attr("method")},fieldName:function(a){return a.attr("name")},formData:function(a){return a.serializeArray()},multipart:true,multiFileRequest:false,withCredentials:false,
forceIframeUpload:false},o={},p={},H=/^http(s)?:\/\//,r,w=function(){return typeof XMLHttpRequest!=="undefined"&&typeof File!=="undefined"&&(!e.multipart||typeof FormData!=="undefined"||typeof FileReader!=="undefined")},x=function(){if(e.dragDropSupport){if(typeof e.onDocumentDragEnter==="function")o["dragenter."+e.namespace]=function(a){e.onDocumentDragEnter(a)};if(typeof e.onDocumentDragLeave==="function")o["dragleave."+e.namespace]=function(a){e.onDocumentDragLeave(a)};o["dragover."+e.namespace]=
k.onDocumentDragOver;o["drop."+e.namespace]=k.onDocumentDrop;g(document).bind(o);if(typeof e.onDragEnter==="function")p["dragenter."+e.namespace]=function(a){e.onDragEnter(a)};if(typeof e.onDragLeave==="function")p["dragleave."+e.namespace]=function(a){e.onDragLeave(a)};p["dragover."+e.namespace]=k.onDragOver;p["drop."+e.namespace]=k.onDrop;e.dropZone.bind(p)}m.bind("change."+e.namespace,k.onChange)},y=function(){g.each(o,function(a,b){g(document).unbind(a,b)});g.each(p,function(a,b){e.dropZone.unbind(a,
b)});m.unbind("change."+e.namespace)},I=function(a,b,c,d){if(typeof d.onProgress==="function")c.upload.onprogress=function(f){d.onProgress(f,a,b,c,d)};if(typeof d.onLoad==="function")c.onload=function(f){d.onLoad(f,a,b,c,d)};if(typeof d.onAbort==="function")c.onabort=function(f){d.onAbort(f,a,b,c,d)};if(typeof d.onError==="function")c.onerror=function(f){d.onError(f,a,b,c,d)}},z=function(a){if(typeof a.url==="function")return a.url(a.uploadForm||l);return a.url},A=function(a){if(typeof a.method===
"function")return a.method(a.uploadForm||l);return a.method},s=function(a){if(typeof a.fieldName==="function")return a.fieldName(a.fileInput||m);return a.fieldName},t=function(a){var b;if(typeof a.formData==="function")return a.formData(a.uploadForm||l);else if(g.isArray(a.formData))return a.formData;else if(a.formData){b=[];g.each(a.formData,function(c,d){b.push({name:c,value:d})});return b}return[]},J=function(a,b,c){if(c)a.setRequestHeader("X-Requested-With","XMLHttpRequest");else if(b.withCredentials)a.withCredentials=
true;if(g.isArray(b.requestHeaders))g.each(b.requestHeaders,function(d,f){a.setRequestHeader(f[0],f[1])});else b.requestHeaders&&g.each(b.requestHeaders,function(d,f){a.setRequestHeader(d,f)})},K=function(a,b,c){var d=new FormData,f;g.each(t(c),function(i,j){d.append(j.name,j.value)});for(f=0;f<a.length;f+=1)d.append(s(c),a[f]);b.send(d)},L=function(a,b){var c=new FileReader;c.onload=function(d){a.content=d.target.result;b()};c.readAsBinaryString(a)},M=function(a,b,c,d){var f="";g.each(d,function(i,
j){f+="--"+a+'\r\nContent-Disposition: form-data; name="'+unescape(encodeURIComponent(j.name))+'"\r\n\r\n'+unescape(encodeURIComponent(j.value))+"\r\n"});g.each(b,function(i,j){f+="--"+a+'\r\nContent-Disposition: form-data; name="'+unescape(encodeURIComponent(c))+'"; filename="'+unescape(encodeURIComponent(j.name))+'"\r\nContent-Type: '+j.type+"\r\n\r\n"+j.content+"\r\n"});f+="--"+a+"--\r\n";return f},N=function(a,b,c){var d="----MultiPartFormBoundary"+(new Date).getTime(),f,i;b.setRequestHeader("Content-Type",
"multipart/form-data; boundary="+d);f=new G(function(){b.sendAsBinary(M(d,a,s(c),t(c)))},a.length);for(i=0;i<a.length;i+=1)L(a[i],f.complete)},B=function(a,b,c,d){var f=z(d),i;if(H.test(f)){var j=location.host;i=location.protocol.length+2;var n=f.indexOf(j,i);j=n+j.length;i=(n===i||n===f.indexOf("@",i)+1)&&(f.length===j||g.inArray(f.charAt(j),["/","?","#"])!==-1)?true:false}else i=true;I(a,b,c,d);c.open(A(d),f,true);J(c,d,i);if(d.multipart){a=typeof b==="number"?[a[b]]:a;if(typeof FormData!=="undefined")K(a,
c,d);else typeof FileReader!=="undefined"?N(a,c,d):g.error("Browser does neither support FormData nor FileReader interface")}else{d=a[b];i&&c.setRequestHeader("X-File-Name",unescape(encodeURIComponent(d.name)));c.setRequestHeader("Content-Type",d.type);c.send(d)}},C=function(a,b,c,d,f){var i=new XMLHttpRequest,j=g.extend({},e);j.fileInput=c;j.uploadForm=d;typeof j.initUpload==="function"?j.initUpload(a,b,f,i,j,function(){B(b,f,i,j)}):B(b,f,i,j)},D=function(a,b,c,d){var f;if(e.multiFileRequest)C(a,
b,c,d);else for(f=0;f<b.length;f+=1)C(a,b,c,d,f)},O=function(a,b,c){var d=t(c);b.find(":input").not(":disabled").attr("disabled",true).addClass(c.namespace+"_disabled");g.each(d,function(f,i){g('<input type="hidden"/>').attr("name",i.name).val(i.value).addClass(c.namespace+"_form_data").appendTo(b)});a.attr("name",s(c)).appendTo(b)},P=function(a,b,c){a.detach();b.find("."+c.namespace+"_disabled").removeAttr("disabled").removeClass(c.namespace+"_disabled");b.find("."+c.namespace+"_form_data").remove()},
E=function(a,b,c,d){var f=b.attr("action"),i=b.attr("method"),j=b.attr("target");c.unbind("abort").bind("abort",function(n){c.readyState=0;c.unbind("load").attr("src","javascript".concat(":false;"));typeof d.onAbort==="function"&&d.onAbort(n,[{name:a.val(),type:null,size:null}],0,c,d)}).unbind("load").bind("load",function(n){c.readyState=4;typeof d.onLoad==="function"&&d.onLoad(n,[{name:a.val(),type:null,size:null}],0,c,d);g('<iframe src="javascript:false;" style="display:none"></iframe>').appendTo(b).remove()});
b.attr("action",z(d)).attr("method",A(d)).attr("target",c.attr("name"));O(a,b,d);c.readyState=2;b.get(0).submit();P(a,b,d);b.attr("action",f).attr("method",i).attr("target",j)},Q=function(a,b,c){var d=g('<iframe src="javascript:false;" style="display:none" name="iframe_'+e.namespace+"_"+(new Date).getTime()+'"></iframe>'),f=g.extend({},e);f.fileInput=b;f.uploadForm=c;d.readyState=0;d.abort=function(){d.trigger("abort")};d.bind("load",function(){d.unbind("load");typeof f.initUpload==="function"?f.initUpload(a,
[{name:b.val(),type:null,size:null}],0,d,f,function(){E(b,c,d,f)}):E(b,c,d,f)}).appendTo(c)},F=function(){l=(h.is("form")?h:h.find("form")).filter(e.uploadFormFilter)},u=function(){m=l.find("input:file").filter(e.fileInputFilter)};this.onDocumentDragOver=function(a){if(typeof e.onDocumentDragOver==="function"&&e.onDocumentDragOver(a)===false)return false;a.preventDefault()};this.onDocumentDrop=function(a){if(typeof e.onDocumentDrop==="function"&&e.onDocumentDrop(a)===false)return false;a.preventDefault()};
this.onDragOver=function(a){if(typeof e.onDragOver==="function"&&e.onDragOver(a)===false)return false;var b=a.originalEvent.dataTransfer;if(b&&b.files){b.dropEffect=b.effectAllowed="copy";a.preventDefault()}};this.onDrop=function(a){if(typeof e.onDrop==="function"&&e.onDrop(a)===false)return false;var b=a.originalEvent.dataTransfer;b&&b.files&&w()&&D(a,b.files);a.preventDefault()};this.onChange=function(a){if(typeof e.onChange==="function"&&e.onChange(a)===false)return false;var b=g(a.target),c=g(a.target.form);
if(c.length===1){b.data("file_upload_form",c);var d=b.clone(true);g("<form/>").append(d).get(0).reset();b.after(d).detach();u()}else c=b.data("file_upload_form");!e.forceIframeUpload&&a.target.files&&w()?D(a,a.target.files,b,c):Q(a,b,c)};this.init=function(a){if(a){g.extend(e,a);r=a}F();u();if(h.data(e.namespace))g.error('FileUpload with namespace "'+e.namespace+'" already assigned to this element');else{h.data(e.namespace,k).addClass(e.cssClass);e.dropZone.not(h).addClass(e.cssClass);x()}};this.options=
function(a){var b,c,d,f;if(typeof a==="undefined")return g.extend({},e);r&&g.extend(r,a);y();g.each(a,function(i,j){switch(i){case "namespace":g.error("The FileUpload namespace cannot be updated.");return;case "uploadFormFilter":f=d=true;break;case "fileInputFilter":f=true;break;case "cssClass":b=e.cssClass;break;case "dropZone":c=e.dropZone}e[i]=j});d&&F();f&&u();if(typeof b!=="undefined"){h.removeClass(b).addClass(e.cssClass);(c?c:e.dropZone).not(h).removeClass(b);e.dropZone.not(h).addClass(e.cssClass)}else if(c){c.not(h).removeClass(e.cssClass);
e.dropZone.not(h).addClass(e.cssClass)}x()};this.option=function(a,b){var c;if(typeof b==="undefined")return e[a];c={};c[a]=b;k.options(c)};this.destroy=function(){y();h.removeData(e.namespace).removeClass(e.cssClass);e.dropZone.not(h).removeClass(e.cssClass)}};q={init:function(h){return this.each(function(){(new v(g(this))).init(h)})},option:function(h,k,l){l=l?l:"file_upload";var m=g(this).data(l);if(m){if(typeof h==="string")return m.option(h,k);return m.options(h)}else g.error('No FileUpload with namespace "'+
l+'" assigned to this element')},destroy:function(h){h=h?h:"file_upload";return this.each(function(){var k=g(this).data(h);k?k.destroy():g.error('No FileUpload with namespace "'+h+'" assigned to this element')})}};g.fn.fileUpload=function(h){if(q[h])return q[h].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof h==="object"||!h)return q.init.apply(this,arguments);else g.error("Method "+h+" does not exist on jQuery.fileUpload")}})(jQuery);
