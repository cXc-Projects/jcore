(function(b){function n(c,e,d){var f,g,m=c.width,i=c.width,a;g=b(c.parentNode);this.element=f=g.append("<canvas class='reflection' style='position:absolute'/>").find(":last")[0];if(!f.getContext&&b.browser.msie)this.element=f=g.append("<img class='reflection' style='position:absolute'/>").find(":last")[0],f.src=c.src,f.style.filter="flipv progid:DXImageTransform.Microsoft.Alpha(opacity="+d*100+", style=1, finishOpacity=0, startx=0, starty=0, finishx=0, finishy="+e/i*100+")";else{g=f.getContext("2d");
try{b(f).attr({width:m,height:e}),g.save(),g.translate(0,i-1),g.scale(1,-1),g.drawImage(c,0,0,m,i),g.restore(),g.globalCompositeOperation="destination-out",a=g.createLinearGradient(0,0,0,e),a.addColorStop(0,"rgba(255, 255, 255, "+(1-d)+")"),a.addColorStop(1,"rgba(255, 255, 255, 1.0)"),g.fillStyle=a,g.fillRect(0,0,m,e)}catch(v){return}}b(f).attr({alt:b(c).attr("alt"),title:b(c).attr("title")})}var o=function(c,e){this.orgWidth=c.width;this.orgHeight=c.height;this.image=c;this.reflection=null;this.alt=
c.alt;this.title=c.title;this.imageOK=!1;this.options=e;this.imageOK=!0;if(this.options.reflHeight>0)this.reflection=new n(this.image,this.options.reflHeight,this.options.reflOpacity);b(this.image).css("position","absolute")},s=function(c,e,d){var f=[],g=Math.sin,m=Math.cos,i=this;this.controlTimer=0;this.stopped=!1;this.container=c;this.xRadius=d.xRadius;this.yRadius=d.yRadius;this.autoRotateTimer=this.showFrontTextTimer=0;if(d.xRadius===0)this.xRadius=b(c).width()/2.3;if(d.yRadius===0)this.yRadius=
b(c).height()/6;this.xCentre=d.xPos;this.yCentre=d.yPos;this.frontIndex=0;this.rotation=this.destRotation=Math.PI/2;this.timeDelay=1E3/d.FPS;d.altBox!==null&&(b(d.altBox).css("display","block"),b(d.titleBox).css("display","block"));b(c).css({position:"relative",overflow:"hidden"});b(d.buttonLeft).css("display","inline");b(d.buttonRight).css("display","inline");b(d.buttonLeft).bind("mouseup",this,function(a){a.data.rotate(-1);return!1});b(d.buttonRight).bind("mouseup",this,function(a){a.data.rotate(1);
return!1});d.mouseWheel&&b(c).bind("mousewheel",this,function(a,b){a.data.rotate(b);return!1});b(c).bind("mouseover click",this,function(a){clearInterval(a.data.autoRotateTimer);var c=b(a.target).attr("alt");c!==void 0&&c!==null&&(clearTimeout(a.data.showFrontTextTimer),b(d.altBox).html(b(a.target).attr("alt")),b(d.titleBox).html(b(a.target).attr("title")),d.bringToFront&&a.type=="click"&&(c=(b(a.target).data("itemIndex")-a.data.frontIndex)%e.length,Math.abs(c)>e.length/2&&(c+=c>0?-e.length:e.length),
a.data.rotate(-c)))});b(c).bind("mouseout",this,function(a){var b=a.data;clearTimeout(b.showFrontTextTimer);b.showFrontTextTimer=setTimeout(function(){b.showFrontText()},1E3);b.autoRotate()});b(c).bind("mousedown",this,function(a){a.data.container.focus();return!1});c.onselectstart=function(){return!1};this.innerWrapper=b(c).wrapInner('<div style="position:absolute;width:100%;height:100%;"/>').children()[0];this.showFrontText=function(){f[this.frontIndex]!==void 0&&(b(d.titleBox).html(b(f[this.frontIndex].image).attr("title")),
b(d.altBox).html(b(f[this.frontIndex].image).attr("alt")))};this.go=function(){if(this.controlTimer===0){var a=this;this.controlTimer=setTimeout(function(){a.updateAll()},this.timeDelay)}};this.stop=function(){clearTimeout(this.controlTimer);this.controlTimer=0};this.rotate=function(a){this.frontIndex-=a;this.frontIndex%=f.length;this.destRotation+=Math.PI/f.length*2*a;this.showFrontText();this.go()};this.autoRotate=function(){if(d.autoRotate!=="no"){var a=d.autoRotate==="right"?1:-1;this.autoRotateTimer=
setInterval(function(){i.rotate(a)},d.autoRotateDelay)}};this.updateAll=function(){var a=d.minScale,c=(1-a)*0.5,e,i,l,p,k,h;l=this.destRotation-this.rotation;var t=Math.abs(l);this.rotation+=l*d.speed;if(t<0.001)this.rotation=this.destRotation;var u=f.length,n=Math.PI/u*2,q=this.rotation,o=b.browser.msie;this.innerWrapper.style.display="none";for(var j,s=this,r=0;r<u;r++){h=f[r];e=g(q);k=(e+1)*c+a;l=this.xCentre+(m(q)*this.xRadius-h.orgWidth*0.5)*k;p=this.yCentre+e*this.yRadius*k;if(h.imageOK&&(j=
h.image,e=j.width=h.orgWidth*k,i=j.height=h.orgHeight*k,j.style.left=l+"px",j.style.top=p+"px",j.style.zIndex=""+k*100>>0,h.reflection!==null))j=d.reflHeight*k,h=h.reflection.element.style,h.left=l+"px",h.top=p+i+d.reflGap*k+"px",h.width=e+"px",o?h.filter.finishy=j/i*100:h.height=j+"px";q+=n}this.innerWrapper.style.display="block";t>=0.001?this.controlTimer=setTimeout(function(){s.updateAll()},this.timeDelay):this.stop()};this.checkImagesLoaded=function(){var a;for(a=0;a<e.length;a++)if(e[a].width===
void 0||e[a].complete!==void 0&&!e[a].complete)return;for(a=0;a<e.length;a++)f.push(new o(e[a],d)),b(e[a]).data("itemIndex",a);clearInterval(this.tt);this.showFrontText();this.autoRotate();this.updateAll()};this.tt=setInterval(function(){i.checkImagesLoaded()},50)};b.fn.CloudCarousel=function(c){this.each(function(){c=b.extend({},{reflHeight:0,reflOpacity:0.5,reflGap:0,minScale:0.5,xPos:0,yPos:0,xRadius:0,yRadius:0,altBox:null,titleBox:null,FPS:30,autoRotate:"no",autoRotateDelay:1500,speed:0.2,mouseWheel:!1,
bringToFront:!1},c);b(this).data("cloudcarousel",new s(this,b(".cloudcarousel",b(this)),c))});return this}})(jQuery);
